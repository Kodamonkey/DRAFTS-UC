# ==============================================================================
# DRAFTS++ CONFIGURATION - ASTRONOMER ESSENTIALS
# ==============================================================================
#
# This file contains the most commonly used settings for astronomical analysis.
# For advanced configurations, see the files in the advanced-config/ directory:
#
# - advanced-config/performance.yaml  : Advanced performance optimization
# - advanced-config/visualization.yaml: Detailed plotting and visualization settings
# - advanced-config/models.yaml       : Neural network model configurations
# - advanced-config/logging.yaml      : Advanced logging and debugging options
#
# ==============================================================================

# ==============================================================================
# DATA AND FILE PATHS
# ==============================================================================
data:
  # Directory containing input files (.fits, .fil)
  input_dir: "./Data/raw/"

  # Directory where results will be saved (CSVs, plots, logs)
  results_dir: "./ResultsThesis/ALMA-4phases/no-phase2-no-classification-linear/"

  # List of files to process (search patterns)
  # Can specify full names or partial patterns
  # Pipeline will search for files matching any of these patterns
  targets:
    # Caso 1: FAST-FREX (Validación cuantitativa completa)
    # - "FRB20180301_0001" # Caso 1: FAST-FREX - Archivo válido para validación
    #- "3100_0001_00_8bit" # Caso 1: FAST-FREX - Archivo válido para validación

    # Caso 2: B0355+54 (Robustez temporal - YA EJECUTADO)
    # - "B0355+54_FB_20220918" # Caso 2: B0355+54 - Robustez Temporal

    # Caso 3: FRB 121102 (Escalabilidad y descubrimiento científico)
    #- "3096_0001_00_8bit" # FRB 121102 - Effelsberg 1.4 GHz (32.2 GB)
    # - "3097_0001_00_8bit" # FRB 121102 - Effelsberg 1.4 GHz (32.2 GB)
    # - "3098_0001_00_8bit" # FRB 121102 - Effelsberg 1.4 GHz (32.2 GB)
    # - "3099_0001_00_8bit" # FRB 121102 - Effelsberg 1.4 GHz (32.2 GB)
    # - "3100_0001_00_8bit" # FRB 121102 - Effelsberg 1.4 GHz (32.2 GB)
    # - "3101_0001_00_8bit" # FRB 121102 - Effelsberg 1.4 GHz (32.2 GB)
    # - "3102_0001_00_8bit" # FRB 121102 - Effelsberg 1.4 GHz (32.2 GB)

    # Caso 4: ALMA

    - "2017-04-03-08_16_13_142_0006_t10.882_t25.829"
    - "2017-04-03-08_55_22_153_0006_t23.444"
    - "2017-04-03-08-16-13_142_0003_t39.977"
    - "2017-04-03-12_56_05_230_0002_t2.3_t17.395"
    - "2017-04-03-12_56_05_230_0003_t36.548"
    - "2017-04-03-13_38_31_242_0005_t44.169"
    # No0134
    - "2017-04-03-07-55-05_0007"
    # No0142
    - "2017-04-03-08_16_13_0006"
    - "2017-04-03-08_16_13_0003"
    - "2017-04-03-08_16_13_0002"
    - "2017-04-03-08_16_13_0001"
    - "2017-04-03-08_16_13_0008"
    # No0143
    - "2017-04-03-08_25_13_0007"
    - "2017-04-03-08_25_13_0006"
    - "2017-04-03-08_25_13_0005"
    - "2017-04-03-08_25_13_0003"
    # No0152
    - "2017-04-03-08_46_22_0007"
    - "2017-04-03-08_46_22_0006"
    - "2017-04-03-08_46_22_0005"
    - "2017-04-03-08_46_22_0004"
    # No0153
    - "2017-04-03-08_55_22_0006"
    # No0220
    - "2017-04-03-12_26_08_0006"
    - "2017-04-03-12_26_08_0005"
    # No0227
    - "2017-04-03-12_47_05_0008"
    - "2017-04-03-12_47_05_0007"
    - "2017-04-03-12_47_05_0005"
    - "2017-04-03-12_47_05_0003"
    - "2017-04-03-12_47_05_0002"
    # No0230
    - "2017-04-03-12_56_05_0004"
    - "2017-04-03-12_56_05_0003"
    - "2017-04-03-12_56_05_0002"
    - "2017-04-03-12_56_05_0001"
    # No0240
    - "2017-04-03-13_26_01_0008"
    - "2017-04-03-13_26_01_0004"
    - "2017-04-03-13_26_01_0003"
    # No0242
    - "2017-04-03-13-38-31_0006"
    - "2017-04-03-13_38_31_0005"
    - "2017-04-03-133831_0008"
    - "2017-04-03-133831_0007"
    - "2017-04-03-13_38_31_0004"
    - "2017-04-03-13_38_31_0003"
    - "2017-04-03-13_38_31_0002"
    # No0243
    - "2017-04-03-13-47-01_0001"
    - "2017-04-03-134701_0004"

# ==============================================================================
# TEMPORAL ANALYSIS
# ==============================================================================
temporal:
  # Duration of each temporal segment in milliseconds
  # Common values for FRBs: 100-500 ms, Pulsars: 1000-5000 ms
  # Caso 3: FRB 121102 - Configuración según plan de validación
  slice_duration_ms: 300.0

# ==============================================================================
# DOWNSAMPLING (DATA REDUCTION)
# ==============================================================================
downsampling:
  # Frequency reduction factor (1 = no reduction)
  # Higher values = faster processing, lower frequency resolution
  # Values: 1, 2, 4, 8
  # Caso 3: FRB 121102 - Decimación agresiva para archivos grandes (32.2 GB cada uno)
  frequency_rate: 1

  # Time reduction factor (1 = no reduction)
  # Higher values = faster processing, lower time resolution
  # Common values: 4, 8, 16, 32
  # Caso 3: FRB 121102 - Decimación agresiva 8x8 según plan de validación
  time_rate: 72

# ==============================================================================
# DISPERSION MEASURE (DM) SEARCH RANGE
# ==============================================================================
dispersion:
  # DM search range in pc cm⁻³
  # Adjust according to your source:
  # - Nearby pulsars: 0-100
  # - Extragalactic FRBs: 100-2000
  # - General/unknown: 0-1024
  # Caso 3: FRB 121102 - DM conocido ~560 pc cm⁻³, amplio rango para detección
  dm_min: 0
  dm_max: 3540

# ==============================================================================
# DETECTION THRESHOLDS
# ==============================================================================
thresholds:
  # Minimum probability for valid detection (CenterNet)
  # Higher values = fewer detections but more confidence
  # - Conservative: 0.5-0.7
  # - Balanced: 0.3 (default)
  # - Sensitive: 0.1-0.2
  detection_probability: 0.3

  # Minimum probability to classify as burst (ResNet) in INTENSITY
  # For HF pipeline: Controls Phase 3a (Intensity classification)
  # Higher values = more conservative classification
  # - Conservative: 0.7-0.9
  # - Balanced: 0.5 (default)
  # - Sensitive: 0.3-0.4
  classification_probability: 0.5

  # Minimum probability to classify as burst (ResNet) in LINEAR POLARIZATION
  # For HF pipeline: Controls Phase 3b (Linear classification)
  # Independent threshold for Linear polarization morphology
  # - Conservative: 0.7-0.9
  # - Balanced: 0.5-0.6 (default)
  # - Sensitive: 0.3-0.4
  classification_probability_linear: 0.3

  # SNR threshold for matched filtering in INTENSITY
  # For HF pipeline: Controls Phase 1 (Matched Filtering detection)
  # - Conservative: 5.0-7.0
  # - Balanced: 5.0 (default)
  # - Sensitive: 3.0-5.0
  snr_threshold: 5.0

  # SNR threshold for matched filtering in LINEAR POLARIZATION
  # For HF pipeline: Controls Phase 2 (Linear SNR validation)
  # Independent threshold for Linear polarization SNR
  # - Conservative: 5.0-7.0
  # - Balanced: 5.0 (default)
  # - Sensitive: 3.0-5.0
  snr_threshold_linear: 3.0

# ==============================================================================
# MULTI-BAND ANALYSIS
# ==============================================================================
multiband:
  # Enable multi-band analysis (Full/Low/High frequency bands)
  # Useful for:
  # - Detailed frequency characterization
  # - Identifying band-dependent RFI
  # - Scattering studies
  # Note: Increases processing time ~3x
  enabled: false

# ==============================================================================
# HIGH-FREQUENCY PIPELINE (>8 GHz)
# ==============================================================================
high_frequency:
  # Automatically enable high-frequency pipeline
  # when central frequency exceeds threshold
  # Useful for: ALMA, mm-wave observations
  auto_enable: true

  # Central frequency threshold in MHz
  # Default: 8000 MHz (8 GHz) for ALMA
  threshold_mhz: 8000.0

  # ============================================================================
  # PHASE 2: LINEAR POLARIZATION SNR VALIDATION
  # ============================================================================
  # Enable Phase 2: Re-evaluate peaks detected in Intensity using SNR in Linear
  # This filters RFI that has high SNR in I but low SNR in L (non-polarized RFI)
  # - true: More conservative, better RFI rejection (requires SNR_L >= threshold)
  # - false: Skip Phase 2, all peaks from Phase 1 go to Phase 3
  enable_linear_validation: false

  # ============================================================================
  # PHASE 3: RESNET18 CLASSIFICATION CONTROL
  # ============================================================================
  # Enable Phase 3a: ResNet18 classification on INTENSITY patches
  # Controls whether Intensity morphology is validated via CNN
  # - true: Validate morphology in Intensity (standard)
  # - false: Skip Intensity classification (NOT RECOMMENDED)
  # NOTE: At least ONE of (intensity OR linear) must be enabled
  enable_intensity_classification: true

  # Enable Phase 3b: ResNet18 classification on LINEAR POLARIZATION patches
  # Controls whether Linear morphology is validated via CNN
  # - true: Validate morphology in Linear (dual validation, STRICT mode)
  # - false: Skip Linear classification (PERMISSIVE mode, only Intensity)
  # NOTE: Requires multi-pol data (IQUV). At least ONE of (intensity OR linear) must be enabled
  enable_linear_classification: false

# ==============================================================================
# POLARIZATION (PSRFITS)
# ==============================================================================
polarization:
  # Polarization mode for PSRFITS files with IQUV
  # Options:
  # - "intensity"  : Stokes I (total intensity) [DEFAULT]
  # - "linear"     : Linear polarization √(Q² + U²)
  # - "circular"   : Circular polarization |V|
  # - "pol0/1/2/3" : Individual polarizations
  mode: "intensity"

  # Default index when IQUV not available (e.g., AABB)
  # Values: 0-3
  default_index: 0

# ==============================================================================
# BASIC PERFORMANCE SETTINGS
# ==============================================================================
performance:
  # Maximum RAM fraction to use (0.1 = 10%, 0.25 = 25%)
  # Lower values are safer for systems with limited RAM
  # Recommended values:
  # - 0.10: Very conservative (4-8GB RAM systems)
  # - 0.15: Conservative (8-16GB RAM systems) [CURRENT]
  # - 0.25: Balanced (16GB+ RAM systems)
  #
  # DEPENDENCY: This value affects dm_chunking_threshold_gb below.
  # RAM_utilizable = (RAM_total × max_ram_fraction × 0.8) / 1.3
  # When changing this, adjust dm_chunking_threshold_gb accordingly.
  max_ram_fraction: 0.10

  # Maximum chunk size in samples
  # Prevents memory issues with very large files
  # Recommended values:
  # - 250,000: Very conservative (~13s chunks)
  # - 500,000: Conservative (~25s chunks) [CURRENT]
  # - 1,000,000: Balanced (~51s chunks)
  max_chunk_samples: 500000

  # Maximum DM-time cube size (GB)
  # Limits the size of the DM-time cube directly, regardless of chunk size
  # This is especially important for high DM ranges (DM > 1000)
  # The system will automatically reduce chunk size if needed to respect this limit
  # Recommended values:
  # - 1.0: Very conservative (for systems with limited RAM/VRAM)
  # - 2.0: Conservative (good balance) [CURRENT]
  # - 4.0: Balanced (for systems with more RAM/VRAM)
  # - 8.0: Aggressive (for high-end systems)
  #
  # NOTE: This limit works together with max_chunk_samples above.
  # The system uses the MORE RESTRICTIVE limit.
  # Example: With DM=10000, even 500K samples would create a ~56 GB cube.
  # This limit (2 GB) will automatically reduce chunk to ~16K samples.
  max_dm_cube_size_gb: 0.5

  # DM chunking threshold (GB)
  # If DM-time cube would exceed this size, automatically split DM range
  # This is the most important parameter for preventing memory errors
  #
  # DEPENDENCY: This value should be related to max_ram_fraction above.
  # Formula: RAM_utilizable = (RAM_total × max_ram_fraction × 0.8) / 1.3
  # Recommended: dm_chunking_threshold_gb = RAM_utilizable × (0.5 to 1.5)
  #
  # Examples (assuming 16GB RAM total):
  # - max_ram_fraction=0.10 → RAM_utilizable=0.98 GB → threshold=0.5-1.5 GB
  # - max_ram_fraction=0.15 → RAM_utilizable=1.48 GB → threshold=0.7-2.2 GB [CURRENT]
  # - max_ram_fraction=0.25 → RAM_utilizable=2.46 GB → threshold=1.2-3.7 GB
  #
  # Quick reference by RAM total (with max_ram_fraction=0.15):
  # - 8 GB RAM:  RAM_utilizable=0.74 GB  → threshold=0.5-1.0 GB
  # - 16 GB RAM: RAM_utilizable=1.48 GB → threshold=1.0-2.0 GB [CURRENT]
  # - 32 GB RAM: RAM_utilizable=2.95 GB → threshold=2.0-4.0 GB
  # - 64 GB RAM: RAM_utilizable=5.91 GB → threshold=4.0-8.0 GB
  dm_chunking_threshold_gb: 2.0

# ==============================================================================
# OUTPUT CONTROL
# ==============================================================================
output:
  # Control which candidates to save to CSV
  #
  # For STANDARD PIPELINE (<8 GHz):
  #   true  = Save only candidates classified as BURST by ResNet
  #   false = Save all CenterNet detections (BURST and NON-BURST)
  #
  # For HIGH-FREQUENCY PIPELINE (≥8 GHz with multi-pol):
  #   true  = Save ONLY if ResNet classifies BURST in BOTH Intensity AND Linear
  #   false = Save if ResNet classifies BURST in Intensity (regardless of Linear)
  #
  # Recommendation:
  #   - Use 'true' for production (highest confidence)
  #   - Use 'false' for exploratory analysis
  save_only_burst: false

# ==============================================================================
# DEBUG AND DIAGNOSTICS
# ==============================================================================
debug:
  # Show detailed frequency and file information
  # Useful for diagnosing frequency ordering issues
  show_frequency_info: false

  # Force plot generation even without candidates
  # Useful for verifying data quality and debugging
  force_plots: false
# ==============================================================================
# ADVANCED CONFIGURATIONS
# ==============================================================================
#
# For more detailed control over the pipeline behavior, edit these files:
#
# advanced-config/performance.yaml:
#   - Advanced memory management
#   - GPU optimization settings
#   - I/O and parallel processing options
#   - Profiling and benchmarking tools
#
# advanced-config/visualization.yaml:
#   - Plot styling and colormaps
#   - SNR visualization settings
#   - DM range plotting options
#   - Export formats and quality
#
# advanced-config/models.yaml:
#   - Neural network architecture settings
#   - Inference optimization options
#   - Model validation and debugging
#   - Experimental features
#
# advanced-config/logging.yaml:
#   - Detailed logging configuration
#   - Component-specific log levels
#   - Performance monitoring
#   - Error handling and analysis
#
# ==============================================================================
